<mxfile host="app.diagrams.net" modified="2020-08-28T09:19:38.643Z" agent="5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.25 Safari/537.36 Core/1.70.3775.400 QQBrowser/10.6.4208.400" etag="gXg3B4hRSsNkhBsGIihX" version="13.6.5" type="github">
  <diagram id="26kdJRuqCQegP6NZ71eM" name="Page-1">
    <mxGraphModel dx="1331" dy="696" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-2" target="SZ_c_wbg-18-UfX0OG9w-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-2" value="&lt;b&gt;ha_innobase::write_row&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-4" target="SZ_c_wbg-18-UfX0OG9w-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-4" value="&lt;b&gt;row_insert_for_mysql&lt;/b&gt;&lt;br&gt;mysql_rec为server层的记录" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="230" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-6" target="SZ_c_wbg-18-UfX0OG9w-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-6" value="&lt;b&gt;row_insert_for_mysql_using_ins_graph&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="390" y="230" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-10" target="SZ_c_wbg-18-UfX0OG9w-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-10" target="SZ_c_wbg-18-UfX0OG9w-16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-10" value="&lt;b&gt;row_get_prebuilt_insert_row(row_prebuilt_t*&lt;span&gt;	&lt;/span&gt;prebuilt)&lt;/b&gt;&lt;br&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;函数主要就是为m_prebuilt-&amp;gt;ins_node 各成员赋值的，ins_node_t 结构体，其成员变量dtuple_t 是record 在innodb 保存的格式，创建dtuple_t 的时候也一块创建了n_fields 个 dfield_t 对象，dfield_t 对象在dtuple_t 结构尾部。&lt;/font&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="360" y="430" width="300" height="160" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-13" target="SZ_c_wbg-18-UfX0OG9w-31">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-13" target="SZ_c_wbg-18-UfX0OG9w-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-13" value="&lt;b&gt;row_mysql_convert_row_to_innobase&lt;br&gt;&lt;/b&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; font-size: medium ; background-color: rgb(255 , 255 , 255)&quot;&gt;该函数把 server record fomat 转成innobase record format，不同数据类型处理方式不同，比如整形server端是小端存储，innodb是大端存储，每个列保存在dtule_t::dfield_t 中,&lt;/span&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; font-size: medium ; background-color: rgb(255 , 255 , 255)&quot;&gt;现在用户定义的列的数据有了，系统列的值还没绑定&lt;/span&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="360" y="720" width="300" height="160" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-16" target="SZ_c_wbg-18-UfX0OG9w-18">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-16" value="&lt;b&gt;ins_node_create&lt;/b&gt;&lt;br&gt;准备prebuilt-&amp;gt;ins_node" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="830" y="480" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-18" target="SZ_c_wbg-18-UfX0OG9w-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-18" value="&lt;b&gt;dict_table_copy_types(row, table)&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;将table的元数据信息赋值给dtuple_t*&lt;span&gt;	&lt;/span&gt;row;&lt;br&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; background-color: rgb(255 , 255 , 255)&quot;&gt;函数把dict_table_t 表t1的每个 dict_col_t 的信息拷贝到对应的 dfield_t 中，此时还不包括recode data&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; font-size: medium ; background-color: rgb(255 , 255 , 255)&quot;&gt;。&lt;/span&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1070" y="445" width="240" height="130" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-27" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-20" target="SZ_c_wbg-18-UfX0OG9w-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-20" value="&lt;b&gt;ins_node_set_new_row(node, row)&lt;br&gt;&lt;/b&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;注意此时dtuple_t 中 dfiled_t 的排列顺序是这样的： a, b,c,row_id,trx_id,roll_ptr。这个顺序与index 中的排列并不相同，比如clusted index 记录列的排列顺序是这样的：a,trx_id,roll_ptr,b,c，所以还需要创建index 对应的dtuple_t ，每个index 对应一个dtuple_t，ins_node_set_new_row 函数完成此工作。&lt;/font&gt;&lt;/span&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1390" y="417.5" width="310" height="185" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-29" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-26" target="SZ_c_wbg-18-UfX0OG9w-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-26" value="&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; font-size: medium ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;b&gt;ins_node_create_entry_list&amp;nbsp;&lt;/b&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; font-size: medium ; background-color: rgb(255 , 255 , 255)&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;创建 index entry，不同index 包含不同的dfield_t，比如表有主键就不需要row_id了，所有index entry保存在ins_node_t::entry_list链表中。创建 index entry 使用了dict_index_t 结构体&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; font-size: medium ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;br&gt;&lt;/span&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1400" y="760" width="290" height="195" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-28" value="&lt;b&gt;row_ins_alloc_sys_fields&lt;br&gt;&lt;/b&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;为sys field 分配内存，这部分内存是从ins_node_t::entry_sys_heap 中分配的，此时 trx_id 和 roll_ptr还未真正赋值到这些内存区域。&lt;/font&gt;&lt;/span&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1420" y="1130" width="250" height="110" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-30" value="&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; font-size: medium ; background-color: rgb(255 , 255 , 255)&quot;&gt;上面这一系列操作完成后，目前的状态是表的dtuple_t 已经准备好了，index entry 也准备好了，就差record 数据了。&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1580" y="1030" width="360" height="80" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-31" value="&lt;b&gt;row_mysql_store_col_in_innobase_format&lt;/b&gt;&lt;br&gt;大端小端转换" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="830" y="770" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-33" target="SZ_c_wbg-18-UfX0OG9w-35">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-33" value="&lt;b&gt;row_ins_step&lt;br&gt;记录插入逻辑&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="450" y="1010" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-38" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-35" target="SZ_c_wbg-18-UfX0OG9w-37">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-35" value="&lt;b&gt;trx_write_trx_id&lt;/b&gt;&lt;br&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;trx_id 的赋值&lt;/font&gt;&lt;/span&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="600" y="1010" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-40" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-37" target="SZ_c_wbg-18-UfX0OG9w-39">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-37" value="&lt;b&gt;row_ins&lt;br&gt;&lt;/b&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;遍历表的每个index，插入 index entry&lt;/font&gt;&lt;/span&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="760" y="1010" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-39" target="SZ_c_wbg-18-UfX0OG9w-41">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-39" value="&lt;b&gt;row_ins_get_row_from_values&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="910" y="1010" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-45" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-41" target="SZ_c_wbg-18-UfX0OG9w-44">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-41" value="&lt;b&gt;row_ins_index_entry_step&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1141" y="1010" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-47" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-44" target="SZ_c_wbg-18-UfX0OG9w-46">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-44" value="&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;&lt;b&gt;row_ins_index_entry_set_vals&lt;br&gt;&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;把 innobase format field 的值赋给对应的index entry field&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;&lt;b&gt;&amp;nbsp;&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1151.5" y="1150" width="179" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-46" target="SZ_c_wbg-18-UfX0OG9w-48">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-46" value="&lt;b&gt;row_ins_index_entry&lt;/b&gt;&lt;br&gt;Inserts an index entry to index." style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1151" y="1290" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-48" target="SZ_c_wbg-18-UfX0OG9w-50">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-48" value="&lt;b&gt;row_ins_clust_index_entry&lt;/b&gt;&lt;br&gt;Inserts an entry into a clustered index." style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1441" y="1290" width="199" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-50" target="SZ_c_wbg-18-UfX0OG9w-53">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-50" value="&lt;b&gt;row_ins_clust_index_entry_low&lt;/b&gt;&lt;br&gt;Tries to insert an entry into a clustered index" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1445.75" y="1440" width="189.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-52" value="&lt;span style=&quot;color: rgb(26 , 26 , 26) ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;该函数会打开cursor ，定位到插入的page，该过程本文不介绍。page 定位到之后，还不能着急插入，因为physical record 还没构建。向page 插入的函数是btr_cur_optimistic_insert&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1280" y="1470" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-53" target="SZ_c_wbg-18-UfX0OG9w-57">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-53" value="&lt;b&gt;btr_cur_optimistic_insert&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1750" y="1440" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-61" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-55" target="SZ_c_wbg-18-UfX0OG9w-60">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-55" value="&lt;b&gt;page_cur_tuple_insert&lt;/b&gt;&lt;br&gt;插入逻辑" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1760" y="1690" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-59" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-57" target="SZ_c_wbg-18-UfX0OG9w-55">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-57" value="&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;&lt;b&gt;btr_cur_ins_lock_and_undo&lt;br&gt;&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;完成与lock 和 undo 有关的操作，并且赋值 roll_ptr 给 field&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;&lt;b&gt;&amp;nbsp;&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1730" y="1580" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-63" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-60" target="SZ_c_wbg-18-UfX0OG9w-62">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-60" value="&lt;b&gt;rec_get_converted_size&lt;br&gt;&lt;/b&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;计算 physical record 的大小&lt;/font&gt;&lt;/span&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1980" y="1690" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-68" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="SZ_c_wbg-18-UfX0OG9w-62" target="SZ_c_wbg-18-UfX0OG9w-67">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-62" value="&lt;b&gt;rec_t* rec=rec_convert_dtuple_to_rec&lt;/b&gt;&lt;br&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;分配好内存，按照 Compact 格式装填数据，也就是把 dtuple_t 转换成physical record ，该过程在rec_convert_dtuple_to_rec函数内完成&lt;/font&gt;&lt;/span&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2270" y="1670" width="190" height="100" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-64" value="&lt;b&gt;重要&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2340" y="1620" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="SZ_c_wbg-18-UfX0OG9w-67" value="&lt;b&gt;rec_get_offsets&lt;br&gt;&lt;/b&gt;&lt;span style=&quot;color: rgb(26 , 26 , 26) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;source han sans sc&amp;#34; , &amp;#34;noto sans cjk sc&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;rec 指向记录真实数据开始位置，还需要计算offsets ，offsets 不光记录了每个字段的偏移和长度，还计算了extra_size 的长度，感觉这里innodb 代码比较啰嗦，上文就介绍过rec_size 都计算完了，只是没区分extra_size 和data_size。&lt;/font&gt;&lt;/span&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2550" y="1660" width="220" height="120" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
